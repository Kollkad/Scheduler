# backend/app/common/config/task_mappings.py
"""
Конфигурация задач для модуля управления задачами.

Содержит маппинг условий формирования задач для различных типов производств:
- Исковое производство (lawsuit)
- Приказное производство (order)
- Документы (documents)

Каждая задача содержит:
- conditions: основные условия формирования [completion_status, monitoring_status]
- special_conditions: дополнительные условия проверки (опционально)
- task_code: уникальный идентификатор задачи
- task_text: текст задачи для отображения пользователю
- reason_text: пояснение причины постановки задачи
- source: источник данных для проверки
"""

TASK_MAPPINGS = {
    "lawsuit": {
        "closed": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_CLOSED_001",
                "task_text": "Обеспечить закрытие дела. Обновить данные 'Дата закрытия дела' в системе",
                "reason_text": "Проверяется срок закрытия дела. Должно быть закрыто в течение 125 календарных дней с Даты подачи иска/заявления. Задача ставится если: Дата закрытия дела отсутствует и срок превышен, или Дата закрытия дела позже дедлайна",
                "source": "detailed_report"
            }
        ],

        "executionDocumentReceivedL": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_EDR_001",
                "task_text": "Обеспечить получение подтверждения исполнительного листа ПСИП",
                "reason_text": "Проверяется получение подтверждения исполнительного листа ПСИП. Задача ставится если: документ 'Исполнительный лист' для ПСИП отсутствует в отчете документов, или статус мониторинга 'overdue', или 'Суть ответа' не содержит 'Передача подтверждена'",
                "source": "detailed_report"
            }
        ],

        "decisionMade": [
            {
                "index": "special",
                "special_conditions": {
                    "column": "CHARACTERISTICS_FINAL_COURT_ACT",
                    "value": "Не в пользу Банка"
                },
                "task_code": "LS_DM_001",
                "task_text": "Принятие решение об обжаловании",
                "reason_text": "Проверяется Характеристика финального судебного акта. Задача ставится если значение равно 'Не в пользу Банка'. Требуется решение об обжаловании судебного акта",
                "source": "detailed_report"
            },
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_DM_002",
                "task_text": "Отразить дату вступления в законную силу",
                "reason_text": "Проверяется Дата вступления в законную силу решения суда. Задача ставится если поле не заполнено и с Даты вынесения решения суда прошло более 45 дней, или дата отсутствует при просроченном сроке",
                "source": "detailed_report"
            },
            {
                "index": 1,
                "conditions": ["false", "overdue"],
                "task_code": "LS_DM_003",
                "task_text": "Обеспечить получение решения суда / судебного приказа / судебного акта",
                "reason_text": "Проверяется получение решения суда. Должно быть получено в течение 3 дней с Даты вынесения решения. Задача ставится если: Дата получения решения суда отсутствует и срок превышен, или дата получения позже дедлайна",
                "source": "detailed_report"
            },
            {
                "index": 2,
                "conditions": ["false", "overdue"],
                "task_code": "LS_DM_004",
                "task_text": "Обеспечить передачу решения суда / судебного приказа / судебного акта",
                "reason_text": "Проверяется передача решения суда. Должна быть выполнена в течение 1 дня с Даты вынесения решения. Задача ставится если: Фактическая дата передачи ИД отсутствует и срок превышен, или дата передачи позже дедлайна",
                "source": "detailed_report"
            }
        ],

        "underConsideration": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_UC_001",
                "task_text": "Фиксировать реакцию суда(новая дата, 'решение вынесено')",
                "reason_text": "Проверяется назначение следующего заседания. Должно быть назначено в течение 3 рабочих дней с Даты вынесения определения суда. Задача ставится если: Дата ближайшего заседания суда отсутствует и срок превышен, или дата заседания позже дедлайна",
                "source": "detailed_report"
            },
            {
                "index": 1,
                "conditions": ["false", "overdue"],
                "task_code": "LS_UC_002",
                "task_text": "Фиксировать реакцию суда(новая дата, 'решение вынесено')",
                "reason_text": "Проверяется интервал между заседаниями. Между Дата предыдущего заседания и Дата ближайшего заседания суда должно быть не более 2 рабочих дней. Задача ставится если интервал превышен или даты отсутствуют",
                "source": "detailed_report"
            },
            {
                "index": 2,
                "conditions": ["false", "overdue"],
                "task_code": "LS_UC_003",
                "task_text": "Обеспечить вынесение решения суда",
                "reason_text": "Проверяется длительность рассмотрения дела. Дело не должно находиться в статусе 'На рассмотрении' более 60 календарных дней с Даты подачи иска/заявления. Задача ставится если срок превышен",
                "source": "detailed_report"
            }
        ],

        "courtReaction": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_CR_001",
                "task_text": "Отобразить реакцию суда",
                "reason_text": "Проверяется получение реакции суда. Должна быть получена в течение 7 рабочих дней с Даты подачи иска/заявления. Задача ставится если: Дата вынесения определения суда отсутствует и срок превышен",
                "source": "detailed_report"
            }
        ],

        "firstStatusChanged": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "LS_FSC_001",
                "task_text": "Проверить подачу документов в суд",
                "reason_text": "Проверяется смена статуса с 'Подготовка документов'. Должна произойти в течение 14 календарных дней с Даты подачи иска/заявления. Задача ставится если статус не сменился и срок превышен",
                "source": "detailed_report"
            }
        ]
    },

    "order": {
        "closed": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "ORD_CLOSED_001",
                "task_text": "Обеспечить закрытие дела. Обновить данные 'Дата закрытия дела' в системе",
                "reason_text": "Проверяется срок закрытия дела. Должно быть закрыто в течение 90 календарных дней с Даты подачи иска/заявления. Задача ставится если: Дата закрытия дела отсутствует и срок превышен, или Дата закрытия дела позже дедлайна",
                "source": "detailed_report"
            }
        ],

        "executionDocumentReceivedO": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "ORD_EDR_001",
                "task_text": "Обеспечить получение подтверждения исполнительного листа ПСИП",
                "reason_text": "Проверяется получение подтверждения исполнительного листа ПСИП. Задача ставится если: документ 'Исполнительный лист' для ПСИП отсутствует в отчете документов, или статус мониторинга 'overdue', или 'Суть ответа' не содержит 'Передача подтверждена'",
                "source": "detailed_report"
            },
            {
                "index": "special",
                "special_conditions": {
                    "status": "Условно закрыто",
                    "has_transfer_date": True
                },
                "task_code": "ORD_EDR_002",
                "task_text": "Закрыть дело в системе",
                "reason_text": "Проверяется статус 'Условно закрыто' и наличие Фактической даты передачи ИД. Задача ставится если статус 'Условно закрыто' и дата передачи заполнена, но дело не закрыто окончательно",
                "source": "detailed_report"
            },
            {
                "index": "special",
                "special_conditions": {
                    "status": "Условно закрыто",
                    "has_transfer_date": False
                },
                "task_code": "ORD_EDR_003",
                "task_text": "Передать СП",
                "reason_text": "Проверяется статус 'Условно закрыто' и отсутствие Фактической даты передачи ИД. Задача ставится если статус 'Условно закрыто' но дата передачи не заполнена, требуется передача судебного приказа",
                "source": "detailed_report"
            }
        ],

        "courtReaction": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "ORD_CR_001",
                "task_text": "Обеспечить получение СП",
                "reason_text": "Проверяется получение судебного приказа. Должен быть получен в течение 60 календарных дней с Даты подачи иска/заявления. Задача ставится если: Определение суда не равно 'Судебный приказ', или отсутствуют даты получения/передачи ИД, или статус не 'Условно закрыто'",
                "source": "detailed_report"
            },
            {
                "index": "special",
                "special_conditions": {
                    "check_type": "court_order_delivery"
                },
                "task_code": "ORD_CR_002",
                "task_text": "Убедиться в суде, что СП вынесен и направлен должнику в течение 15 дней",
                "reason_text": "Проверяется вынесение и направление судебного приказа должнику. Задача ставится если требуется подтверждение, что судебный приказ вынесен и направлен должнику в установленный 15-дневный срок",
                "source": "detailed_report"
            }
        ],

        "firstStatusChanged": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "ORD_FSC_001",
                "task_text": "Проверить подачу документов в суд",
                "reason_text": "Проверяется смена статуса с 'Подготовка документов' на 'Ожидание реакции суда'. Должна произойти в течение 14 календарных дней с Даты подачи иска/заявления. Задача ставится если статус не сменился и срок превышен",
                "source": "detailed_report"
            }
        ]
    },

    "documents": {
        "executionDocument": [
            {
                "index": 0,
                "conditions": ["false", "overdue"],
                "task_code": "DOC_ED_001",
                "task_text": "Обеспечить подтверждение передачи документа",
                "reason_text": "Проверяется подтверждение передачи документа. Документ должен быть передан в течение 14 календарных дней с Даты запроса. Задача ставится если: 'Суть ответа' не содержит 'Передача подтверждена' и срок 14 дней превышен, или статус мониторинга 'overdue'",
                "source": "documents_report"
            }
        ]
    }
}