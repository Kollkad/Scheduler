// frontend/client/config/analysisCriteria.ts
export interface AnalysisCriteria {
  stage: string;
  title: string;
  description: string;
  criteria: string[];
  dataSources: string[];
  exceptions?: string[];
}

export const analysisCriteriaConfig: AnalysisCriteria[] = [
    {
    stage: "status_changed",
    title: "1.1.1 Сменился статус с ожидания (14 дней)",
    description: "Анализ изменения статуса дела с 'Ожидает реакции суда' в течение 14 дней с даты подачи иска",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами из evaluate_exceptions_row",
        "Исключаются дела без даты подачи иска",
        "Срок: 14 календарных дней с даты подачи иска",
        "Статус определяется на текущую дату проверки системы",
        "",
        "Условия отбора:",
        " В срок (timely): Статус изменился ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Статус не изменился И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Статус не изменился И дедлайн прошел"
    ],
    dataSources: [
        "Детальный отчет по делам",
        "Дата подачи иска",
        "Текущий статус дела"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается",
        "Статус 'Жалоба подана' - исключается",
        "Статус 'Ошибка-Дубликат' - исключается",
        "Статус 'Отозвано инициатором' - исключается"
    ]
    },
    {
    stage: "court_reaction", 
    title: "1.1.2 Актуальность реакции суда (2 дня)",
    description: "Анализ назначения следующего заседания в течение 2 рабочих дней после предыдущего",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами из evaluate_exceptions_row и 'Решение вынесено'",
        "Исключаются дела без даты предыдущего заседания",
        "",
        "▸ Если следующее заседание УЖЕ НАЗНАЧЕНО:",
        "   В срок: назначено в течение ≤ 2 рабочих дней после предыдущего",
        "   Просрочено: назначено через > 2 рабочих дней после предыдущего",
        "",
        "▸ Если следующее заседание ЕЩЕ НЕ НАЗНАЧЕНО:",
        "   В срок: прошло ≤ 2 рабочих дней с предыдущего заседания",
        "   Скоро истекает: прошло > 2 рабочих дней, но до дедлайна ≤ 14 календарных дней",
        "   Просрочено: дедлайн уже прошел"
    ],
    dataSources: [
        "Дата предыдущего заседания",
        "Дата следующего заседания (если назначено)", 
        "Текущая дата системы"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается",
        "Статус 'Жалоба подана' - исключается",
        "Статус 'Ошибка-Дубликат' - исключается",
        "Статус 'Отозвано инициатором' - исключается",
        "Статус 'Решение вынесено' - исключается"
    ]
    },
    {
    stage: "decision_made",
    title: "1.2 Решение вынесено (74 дня)",
    description: "Анализ вынесения решения по делу в течение 74 дней с даты подачи иска",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами из evaluate_exceptions_row",
        "Исключаются дела без даты подачи иска",
        "Срок: 74 календарных дня с даты подачи иска",
        "",
        "Условия отбора:",
        " В срок (timely): Решение уже вынесено ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Решение не вынесено И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Решение не вынесено И дедлайн уже наступил"
    ],
    dataSources: [
        "Детальный отчет по делам",
        "Дата подачи иска",
        "Текущий статус дела"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается из анализа",
        "Статус 'Жалоба подана' - исключается из анализа",
        "Статус 'Ошибка-Дубликат' - исключается",
        "Статус 'Отозвано инициатором' - исключается",
    ]
    },
    {
    stage: "force_majeure",
    title: "1.3 Вступили в законную силу (110 дней)",
    description: "Анализ вступления решения суда в законную силу в течение 110 дней с даты подачи иска",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами: 'Переоткрыто' и 'Жалоба подана'",
        "Исключаются дела без даты подачи иска",
        "Срок: 110 календарных дней с даты подачи иска",
        "",
        "Условия отбора:",
        " В срок (timely): Решение вступило в силу ≤ 110 дней ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Решение не вступило И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Решение не вступило И дедлайн прошел ИЛИ решение вступило > 110 дней"
    ],
    dataSources: [
        "Детальный отчет по делам",
        "Дата подачи иска",
        "Дата решения суда (если указана)"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается из анализа",
        "Статус 'Жалоба подана' - исключается из анализа"
    ]
    },
    {
    stage: "received_after_force",
    title: "1.4 Получены после вступления в законную силу (120 дней)",
    description: "Анализ получения документа с решением суда в течение 120 дней с даты подачи иска",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами: 'Переоткрыто' и 'Жалоба подана'",
        "Исключаются дела без даты подачи иска",
        "Срок: 120 календарных дней с даты подачи иска",
        "",
        "Условия отбора:",
        " В срок (timely): Документ получен ≤ 120 дней ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Документ не получен И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Документ не получен И дедлайн прошел ИЛИ документ получен > 120 дней"
    ],
    dataSources: [
        "Детальный отчет по делам",
        "Дата подачи иска",
        "Дата получения решения суда (если указана)"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается из анализа",
        "Статус 'Жалоба подана' - исключается из анализа"
    ]
    },
    //1.5 был переработан по указаниям ДЛ(убрана связь с детальным отчетом, отдельная логика)
    {
    stage: "documents_transferred",
    title: "1. 5 Передача документов в срок",
    description: "Анализ соблюдения сроков передачи документов (не более 2 рабочих дней)",
    criteria: [
        "Только дела искового производства",
        "Учитываются только документы с указанной датой получения",
        "Группировка по: [код дела, тип документа, подразделение]",
        "В каждой группе берется документ с последней датой передачи (если есть), иначе - с последней датой получения",
        "Остальные документы в группе считаются дубликатами и отсеиваются",
        "Для документов с датой передачи: срок считается от даты получения до даты передачи",
        "Для документов без даты передачи: срок считается от даты получения до текущей даты",
        "Максимальный срок: 2 рабочих дня",
        "Документы без даты передачи считаются просроченными, если прошло более 2 рабочих дней от даты получения до текущей"
    ],
    dataSources: [
        "Отчет по документам (основной источник)",
        "Дата получения документа",
        "Дата передачи документа",
        "Тип документа",
        "Категория подразделения"
    ],
    exceptions: [
        "Без исключений по статусам 'Жалоба подана' и 'Переоткрыто'",
        "Все дела анализируются по единым критериям"
    ]
    },
    {
    stage: "closed",
    title: "1.6 Закрыты (125 дней)",
    description: "Анализ закрытия дела в течение 125 дней с даты подачи иска",
    criteria: [
        "Только дела искового производства + иск от банка",
        "Исключаются дела со статусами: 'Переоткрыто' и 'Жалоба подана'",
        "Исключаются дела без даты подачи иска",
        "Срок: 125 календарных дней с даты подачи иска",
        "",
        "Условия отбора:",
        " В срок (timely): Дело закрыто ≤ 125 дней ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Дело не закрыто И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Дело не закрыто И дедлайн прошел ИЛИ дело закрыто > 125 дней",
        "Дело закрыто, но дата закрытия не указана → считается 'в срок'",
        "Дело закрыто после 125 дней → считается 'просрочено'"
    ],
    dataSources: [
        "Детальный отчет по делам",
        "Дата подачи иска",
        "Текущий статус дела",
        "Дата закрытия дела (CASE_CLOSING_DATE)"
    ],
    exceptions: [
        "Статус 'Переоткрыто' - исключается из анализа",
        "Статус 'Жалоба подана' - исключается из анализа"
    ]
    },
    {
    stage: "documents_submitted",
    title: "2.1 Подача документов в суд (14 дней)",
    description: "Мониторинг поступления заявления в суд и принятия его к производству в течение 14 дней",
    criteria: [
        "Только дела приказного производства",
        "Исключаются дела без даты подачи иска (LAWSUIT_FILING_DATE)",
        "Срок: 14 календарных дней с даты подачи иска",
        "Результат мониторинга должен быть отражен в комментариях по делу",
        "Комментарий должен быть не 'Комментарии (0)', а содержать фактический текст",
        "",
        "Условия отбора:",
        " В срок (timely): Есть комментарий ИЛИ до дедлайна > 14 дней",
        " Скоро истекает (upcoming_deadline): Нет комментария И до дедлайна ≤ 14 дней",
        " Просрочено (overdue): Нет комментария И дедлайн прошел"
    ],
    dataSources: [
        "Дата подачи иска (LAWSUIT_FILING_DATE)",
        "Комментарии по делу (столбец Комментарий)"
    ],
    exceptions: []
    },
    {
    stage: "refusal_return",
    title: "2.2 Отказ в принятии/возврат заявления (5 рабочих дней)",
    description: "Обработка отказа/возврата заявления судом в течение 5 рабочих дней",
    criteria: [
        "Только дела приказного производства",
        "Применимо только если: 'Определение о возвращении заявления/жалобы' ИЛИ 'Определение об отказе в принятии заявления/жалобы' ИЛИ 'Иное'",
        "Исключаются дела без даты вынесения определения (DETERMINATION_DATE)",
        "Срок: 5 рабочих дней с даты вынесения определения",
        "",
        "Условия отбора:",
        " В срок (timely): ВСЕ условия выполнены:",
        "  - Дата получения финального акта заполнена",
        "  - Дата передачи финального акта заполнена",
        "",
        " Просрочено (overdue): Любое условие не выполнено И текущая дата > (дата определения + 5 рабочих дней)",
        " Ближайший дедлайн (upcoming_deadline): Любое условие не выполнено И текущая дата в пределах 14 дней до дедлайна",
        " В срок (timely): Любое условие не выполнено И текущая дата < дедлайна",
        " Нет данных (no_data): Несоответствующее определение суда или отсутствует дата определения"
    ],
    dataSources: [
        "Определение суда с реакцией (COURT_DETERMINATION)",
        "Дата вынесения определения (DETERMINATION_DATE)",
        "Дата получения финального акта (FINAL_ACT_RECEIPT_DATE)",
        "Дата передачи финального акта (FINAL_ACT_TRANSFER_DATE)"
    ],
    exceptions: [
        "Дела с несоответствующими определениями суда исключаются из анализа",
        "Дела без даты вынесения определения исключаются из анализа"
    ]
    },
    {
    stage: "court_order_issued",
    title: "2.3 Вынесение судебного приказа (40 дней)",
    description: "Мониторинг вынесения судебного приказа в течение 40 дней",
    criteria: [
        "Только дела приказного производства",
        "Исключаются дела без даты подачи иска (LAWSUIT_FILING_DATE)",
        "Применимо только если НЕТ: 'Определение о возвращении/отказе' в столбце BE",
        "Срок: 40 календарных дней с даты подачи иска",
        "Результат мониторинга должен быть отражен в комментариях по делу",
        "Комментарий должен быть не 'Комментарии (0)', а содержать фактический текст",
        "",
        "Условия отбора:",
        " В срок (timely): Есть комментарий ИЛИ до дедлайна > 40 дней",
        " Скоро истекает (upcoming_deadline): Нет комментария И до дедлайна ≤ 40 дней",
        " Просрочено (overdue): Нет комментария И дедлайн прошел"
    ],
    dataSources: [
        "Дата подачи иска (LAWSUIT_FILING_DATE)",
        "Определение суда с реакцией (столбец BE)",
        "Комментарии по делу (столбец FD)"
    ],
    exceptions: []
    },
    {
    stage: "order_received_transferred",
    title: "2.4 Получение и передача судебного приказа (60 дней)",
    description: "Получение и передача судебного приказа в течение 60 дней",
    criteria: [
        "Только дела приказного производства",
        "Исключаются дела без даты подачи иска (LAWSUIT_FILING_DATE)",
        "Срок: 60 календарных дней с даты подачи иска",
        "",
        "Условия отбора:",
        " В срок (timely): ВСЕ условия выполнены:",
        "  - Определение = 'Судебный приказ'",
        "  - Дата получения ИД заполнена",
        "  - Дата передачи ИД заполнена", 
        "  - Статус дела = 'Условно закрыто'",
        "",
        " Просрочено (overdue): Любое условие не выполнено И текущая дата > (дата подачи + 60 дней)",
        " Ближайший дедлайн (upcoming_deadline): Любое условие не выполнено И текущая дата в пределах 14 дней до дедлайна",
        " В срок (timely): Любое условие не выполнено И текущая дата < дедлайна",
        " Нет данных (no_data): Отсутствует дата подачи иска"
    ],
    dataSources: [
        "Дата подачи иска (LAWSUIT_FILING_DATE)",
        "Определение суда с реакцией (COURT_DETERMINATION)",
        "Фактическая дата получения ИД (ACTUAL_RECEIPT_DATE)",
        "Фактическая дата передачи ИД (ACTUAL_TRANSFER_DATE)",
        "Статус дела (CASE_STATUS)"
    ],
    exceptions: [
        "Дела без даты подачи иска исключаются из анализа",
        "Дела с несоответствующим определением суда все равно проверяются на сроки"
    ]
    },
    {
    stage: "documents_transferred",
    title: "2.5 Передача документов (2 дня)",
    description: "Анализ передачи документов по приказному производству в течение 2 календарных дней",
    criteria: [
        "Только дела приказного производства",
        "Исключаются дела без даты получения документа",
        "Срок: 2 календарных дня с даты получения документа",
        " В срок: переданы ≤ 2 дней",
        " Просрочено: переданы > 2 дней или не переданы",
        "Логика на пару с исковым"
    ],
    dataSources: [
        "Дата получения документа",
        "Дата передачи документа"
    ],
    exceptions: []
    }

];

// Вспомогательная функция для получения конфига по этапу
export const getAnalysisCriteria = (stage: string): AnalysisCriteria | undefined => {
  return analysisCriteriaConfig.find(criteria => criteria.stage === stage);
};

// Типы статусов для отображения
export const getStatusDescription = (status: string): string => {
  const statusDescriptions: Record<string, string> = {
    "timely": "Документы переданы в срок (≤ 2 рабочих дня)",
    "upcoming_deadline": "Срок сопровождения истекает в ближайшие 14 дней",
    "overdue": "Документы переданы с просрочкой (> 2 рабочих дня)",
    "no_data": "Недостаточно данных для анализа/не попадает в категорию"
  };
  return statusDescriptions[status] || status;
};